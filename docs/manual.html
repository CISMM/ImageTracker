<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>ImageTracker Manual</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="styles.css" rel="stylesheet" type="text/css" />
</head>

<body>

<div id="header">
<h1>ImageTracker</h1>
</div>

<div id="container">

<div id="navbar">
<ul>
<li><a href="index.html">Home</a></li>
<li><a href="download.html">Download</a></li>
<li><a href="manual.html">Manual</a></li>
<li><a href="building.html">Building</a></li>
<li><a href="about.html">About</a></li>
</ul>
</div>

<div id="content">

<h2>Table of Contents</h2>

<ul>
<li class="toch2"><a href="#introduction">Introduction</a></li>
<li class="toch2"><a href="#installation">Installation</a></li>

<li class="toch2"><a href="#images">Working with Images</a></li>
    <li class="toch3"><a href="#loadingImages">Loading Images</a></li>
    <li class="toch3"><a href="#loadingVectors">Loading Vectors</a></li>
    <li class="toch3"><a href="#vectorVisualization">Vector Visualization</a></li>
    <li class="toch3"><a href="#imageControls">Image Controls</a></li>
    <li class="toch3"><a href="#savingVisualizations">Saving Visualizations</a></li>

<li class="toch2"><a href="#filters">Filters</a></li>
    <li class="toch3"><a href="#savingFilters">Saving Filter Images</a></li>
    <li class="toch3"><a href="#threshold">Threshold</a></li>
    <li class="toch3"><a href="#gaussian">Gaussian</a></li>
    <li class="toch3"><a href="#gradient">Gradient Magnitude</a></li>
    <li class="toch3"><a href="#logarithm">Logarithm</a></li>
    <li class="toch3"><a href="#flatfield">Flatfield</a></li>

<li class="toch2"><a href="#processes">Processes</a></li>
    <li class="toch3"><a href="#occlusions">Remove Occlusions</a></li>
    <li class="toch3"><a href="#stabilize">Stabilize</a></li>
    <li class="toch3"><a href="#transform">Apply Transform</a></li>
    <li class="toch3"><a href="#clgFlow">CLG Optical Flow</a></li>
    <li class="toch3"><a href="#hornFlow">Horn Optical Flow</a></li>
    <li class="toch3"><a href="#integrate">Integrate Flow</a></li>

<li class="toch2"><a href="#versionhistory">Version History</a></li>
    <li class="toch3"><a href="#v3.00">Version 3.00</a></li>
    <li class="toch3"><a href="#v2.08">Version 2.08</a></li>
    <li class="toch3"><a href="#v2.07">Version 2.07</a></li>
    <li class="toch3"><a href="#v2.06">Version 2.06</a></li>
    <li class="toch3"><a href="#v2.05">Version 2.05</a></li>
    <li class="toch3"><a href="#v2.04">Version 2.04</a></li>
    <li class="toch3"><a href="#v2.03">Version 2.03</a></li>
    <li class="toch3"><a href="#v2.02">Version 2.02</a></li>
    <li class="toch3"><a href="#v2.01">Version 2.01</a></li>
    <li class="toch3"><a href="#v2.00">Version 2.00</a></li>
    <li class="toch3"><a href="#v1.00">Version 1.00</a></li>
</ul>

<h2><a name="introduction"></a>Introduction</h2>

<p>ImageTracker is an application designed to track and measure motion in image sequences. Videos often contain motion of several types, and analysis of these motions can be difficult. For example, videos of cells dividing show the cell moving within solution, kinetochores moving back and forth accross the cell equator, and microtubule structures migrating from the equator to the poles. ImageTracker enables analysis of this type of motion through a multiscale approach. The video is first stabilized with respect to global motion and flow analysis of smaller scale structures follows.</p>

<p>ImageTracker was written to analyze microscopy videos. Several challenges in analyzing microscopy video mean ImageTracker's performance will depend partially on the nature of the video being analyzed.  In particular, performance may suffer on videos that have low signal-to-noise ratio, poor feature resolution, sparse temporal sampling (objects move too much between fames), and short object life (features appear and disappear frequently).</p>

<p>The text of this guide refers to the Windows version of ImageTracker, but the screenshots are of the Linux version.  The difference between ImageTracker versions on these two platforms is purely aesthetic.</p>

<h2><a name="installation"></a>Installation</h2>

<p>Remove previous versions of ImageTracker from your computer before installing updates. To uninstall ImageTracker, select Start&mdash;&gt;All Programs&mdash;&gt;NSRG&mdash;&gt;ImageTracker&mdash;&gt;Uninstall ImageTracker from the start menu.</p>

<p><em>Note:</em>  ImageTracker is a stand-alone application and does not require the NSRG Runtime.</p>

<p>Download and execute the installer from the 
<a href="http://www.cs.unc.edu/Research/nano/cismm/download/index.html">
NSRG download page</a>. The NSRG developers recommend that you accept all default parameters in order to conform to NSRG standards. This will create a folder on your harddrive, C:\NSRG\bin\ImageTracker, and will add to your programs menu a folder NSRG\ImageTracker.</p>
<p>Run ImageTracker by selecting Start&mdash;&gt;All Programs&mdash;&gt;NSRG&mdash;&gt; ImageTracker&mdash;&gt;ImageTracker.</p>

<!-- Note: all screen shots in this manual are taken with the ImageTracker main window set to display at a size of 960x700 pixels.-->
<p><span class="figure">
<a href="img/ImageTracker.jpg"><img src="img/ImageTracker.jpg" alt="ImageTracker"/></a>
<p>The ImageTracker main window.</p></span>
The main ImageTracker window is shown to the right. The window consists of a menu bar on the top, a data control panel on the left, and an image panel on the right. ImageTracker will launch new dialog windows for different purposes. Most of these windows may be moved around the screen, resized, or temporarily hidden.</p>

<p>Program information will be written to a logging file at various points during execution. This information may be useful for making sure the application is still running or troubleshooting the application if something goes wrong. You can view the log messages by selecting View&mdash;&gt;Logger. Each log message has an associated logging level on the following scale of increasing severity: Verbose, Debug, Info, Warn, Error.  From the logging window you can limit what messages get logged&mdash;all messages at or above the selected logging level will be written. Info is the recommended logging level; lower levels can produce enough messages to noticably slow down the application. The log messages displayed in the logger dialog do not update automatically.  Press the Refresh button to refresh the logger messages.</p>

<p>Occasionally messages from libraries ImageTracker depends on may be printed to other locations.  Some of the ITK classes used in image registration print messages to the console (standard out) if ImageTracker is launched from a command line (not common on Windows).  VTK classes sometimes print messages to a separate logging window; this usually indicates something has gone very wrong with the visualization system.</p>

<p><span class="figure">
<a href="img/ProgressDialog.jpg"><img src="img/ProgressDialog.jpg" alt="Progress dialog"/></a><p>The progress dialog displayed while ImageTracker is performing image registration.</p></span>
When ImageTracker is performing an image processing task, a progress bar will appear displaying a graphical depiction of about how much of the task has completed as well as an estimate of the time remaining to completion.  A Cancel button on the progress dialog enables a user to request that a process terminate. The task may not terminate immediately after pressing the Cancel button, however; ImageTracker will wait until the next convenient point to stop the process.  A few processing tasks may ignore requests to stop all together&mdash;this may be because at the next convenient stopping point the task is nearly finished anyway.</p>

<h2><a name="images"></a>Working with Images</h2>

<p>ImageTracker operates on stacks of individual image files; a set of images constitutes a video.  ImageTracker can read many types of images, including TIFF, PNG, JPG, MHA, and VTK.  There have been some problems reading some types of TIFF images, but this should be remedied as of ImageTracker v2.00.  Currently, ImageTracker does not support metamorph stacks, video files (<em>e.g.</em> AVI, WMV), or raw camera files.  Software such as <a href="http://rsbweb.nih.gov/ij/">ImageJ</a> can be used to convert images in these file formats into a format ImageTracker can read.</p>

<h2><a name="loadingImages"></a>Loading Images</h2>

<p><span class="figure">
<a href="img/OpenFiles.jpg"><img src="img/OpenFiles.jpg" alt="Image file list"/></a><p>The Image Files control panel specifies which image files are loaded in ImageTracker.</p></span>
ImageTracker can have one active image stack and one active vector stack loaded at a time.  (Previous version could have multiple stacks open at once, but this was a little cumbersome.)  To load an image stack, select the Images tab from the data control panel and select the Image Files item from the filter list at the top.  An Image Files control panel appears below the filter list.  Below the filter list is a list of file names that will be loaded into ImageTracker.  Modify this file list by using one of the buttons below:</p>

<dl>
<dt>Example</dt><dd>Select a single image, and let ImageTracker find files with the same naming convention. This is the easiest way to specify a series of files.</dd>
<dt>Selection</dt><dd>Select multiple files to add to the file list. The file names will be sorted alphabetically as they are added. A maximum of around 1000 file names can be selected at one time.</dd>
<dt>Pattern</dt><dd>Specify a file series naming convention pattern by selecting a root directory, file prefix, number format, file extension, and numeric range. Press the Enter key as you modify each field in the pattern specification dialog to update the example name displayed below. (This option is seldom used&mdash; use it if you have a large number of files in a series, but only want to operate on a subset of that series.)</dd>
<dt>Remove</dt><dd>Remove any selected file names from the list.</dd>
</dl>

When the list of file names is complete, click the Apply button to load the named files into ImageTracker. The first image in the list will be displayed in the image panel.  The Apply button should be pressed whenever any changes are made to the Image File control panel to have those changes reflected in ImageTracker.

<h3><a name="loadingVectors"></a>Loading Vectors</h3>

<p>A <em>vector image</em> is an image in which every pixel contains vector information instead of intensity information.  For example, the output of an optical flow computation, discussed elsewhere in this guide, is a vector image that explains the motion of intensities between images.</p>

<p>Vector data is loaded in a similar way to image data.  Click on the Vectors tab of the data control panel to bring up the vector file control panel.  A list of vector image files can be modified in the same way as the list of image files on the Images tab.  The visualization control panel below the vector file list provides options for how to display the vector image data.</p>

<h3><a name="vectorVisualization"></a>Vector Visualization</h3>

<p>Vector images can be displayed with two different visualizations: Glyph and Height Map.  The Method combo box in the vector visualization control panel selects between these two options.  Controls below this combo box enable modifying aspects of the visualization.</p>

<p><em>Note:</em> if the controls for the current visualization are not visible (this sometimes happens when the vector images are automatically loaded as the result of a processing task), press the Apply button below the vector image list.  This should update the control panel.</p>

<p><span class="figure">
<a href="img/GlyphVisualization.jpg"><img src="img/GlyphVisualization.jpg" alt="Image display"/></a><p>ImageTracker's vector glyph visualization.</p></span>
The Glyph visualization displays regularly-spaced vector glyphs across a vector field. Each glyph is scaled according to the vector magnitude and oriented according to the vector direction. The vector visualization control enables rescaling glyphs&mdash;setting the scaling to 1.0 will match the glyph lengths to the underlying vector magnitudes. Drawing a glyph at every pixel location would clutter the visualization. The Mask Ratio slider adjusts the spacing between adjacent glyphs. Some spacings produce distracting patterns of glyph placement. Generally, adjusting the Mask Ratio up or down by a few values will correct this.</p>

<p><span class="figure">
<a href="img/HeightMapVisualization.jpg"><img src="img/HeightMapVisualization.jpg" alt="Image display"/></a><p>ImageTracker's vector height map visualization.</p></span>
Height map visualization maps the magnitude of the vector image to the height of a surface.  It may be helpful to rotate the image plane to better view the surface when using this visualization.  The Color Map combo box controls the colormap used to paint the surface.  The Scale Factor slider controls the scaling of the surface.  The Magnitude Function combo box selects between height mapping the vector magnitude or a single vector component.</p>

<h3>Other Visualization Options</h3>

<p>ImageTracker provides visualization for computed flow fields (as of version 2.06).  <a href="http://www.paraview.org/HTML/Index.html" target="_blank">ParaView</a>, a free application from <a href="http://www.kitware.com/" target="_blank">Kitware</a>, provides a more flexible visualization application that may be useful when ImageTracker's visualizations are not sufficient.  Follow the instructions from Kitware on how to install and run ParaView.</p>

<p>Another option for people familiar with VTK is <a href="http://www.vistrails.org/index.php/Main_Page" target="_blank">VisTrails</a>, a visualization workflow application from the University of Utah.</p>

<h3><a name="imageControls"></a>Image Controls</h3>

<p><span class="figure">
<a href="img/ViewImage.jpg"><img src="img/ViewImage.jpg" alt="Image display"/></a><p>ImageTracker displaying an image sequence of fibrin sheet manipulation.</p></span>
In the main ImageTracker window, the data control panel on the left displays which image files are currently loaded.  Images are drawn in the image display panel on the right.</p>

<p>To change the magnification of the current image, right click on the image, and drag the mouse up or down. To move the current image, center click on the image and drag the mouse in the desired direction. To rotate an image, left click on the image and drag the mouse.</p>

<p><span class="figure">
<a href="img/WindowContrast.jpg"><img src="img/WindowContrast.jpg" alt="Image display"/></a><p>The Window/Contrast dialog controls display properties of images in ImageTracker.</p></span>
The display properties of the image display panel can be adjusted by selecting View&mdash;&gt;Window/Contrast from the ImageTracker menu.  This dialog controls <em>only the display</em> of images, not the actual intensity values.  The Maximum and Minimum sliders change the intensity values displayed in the image panel.  The Range combo box controls the range of values displayed on the intensity sliders.  The Auto button automatically adjusts the maximum and minimum display values to the maximum and minimum intensity values in the currently displayed image.  You may need to adjust the display contrast when switching between different types of images (<em>e.g.</em> changing from 8-bit to 16-bit images).</p>

<p>Image size and intensity statistics for the currently displayed image can be shown by selecting View&mdash;&gt;Image Info from the menu.  This will display the Logger window with the most recent message containing the image information.  Note that a log level of Info or lower needs to be selected in order for the image information to be displayed.</p>

<p><span class="figure">
<a href="img/FrameControl.jpg"><img src="img/FrameControl.jpg" alt="ImageTracker frame controls"/></a><p>The image frame control in ImageTracker.</p></span>
Controls below the image display panel adjust the index of the frame that is displayed. Move the slider to scan through the loaded images. To jump to a specific frame, enter the frame index in the text box and press Enter. A set of buttons to the right of the slider enables playing, rewinding, pausing, single frame advance and rewind, and skipping to either end of the image sequence.</p>

<p>Images and vector visualizations are displayed simultaneously.  The frame index range is based on the larger of the number of loaded images and loaded vectors.  If the two sequences are of different sizes, the visualization from the shorter sequence will no longer update once the frame index exceeds the length of that sequence.</p>

<h3><a name="savingVisualizations"></a>Saving Visualizations</h3>

<p>To save a visualization displayed by ImageTracker, select File&mdash;&gt;Save View Images. This will bring up a dialog that enables selecting an output directory, file naming convention, and the range of frames to save.  The images saved will be exactly what is displayed in the ImageTracker image panel.  To save the result of applying a set of filters, see the Filters section below.</p>

<p><span class="warning">Warning: Do not let any other window obscure the ImageTracker image display panel and do not minimize ImageTracker when saving visualizations.</span>  Doing so <em>will corrupt</em> the saved images. The frame index slider provides progress information and a message will be displayed when ImageTracker has finished saving the visualizations.</p>

<p><span class="warning">Warning:</span> If you save a set of visualizations, then resize the image display panel, and then try to save another set of visualizations, ImageTracker will crash.  The VTK class responsible for capturing images from the image display panel does not handle this gracefully.</p>

<h2><a name="filters"></a>Filters</h2>

<p>ImageTracker has two main image manipulation modes: filtering and processing.  <em>Filtering</em> applies an operation on images as they are displayed in the ImageTracker image panel, and results are visible instantly.  (This is similar to filtering in other imaging applications such as ImageJ or Gimp.)  <em>Processing</em> typically involves more complex computations that create a new set of output images; those new images must be loaded into ImageTracker to see the results of a processing task.</p>

<p>Filtering is often used to prepare an image set for processing.  The list at the top of the Images tab in the control panel contains the names of all filters that are being actively applied.  The Image Files filter is a special filter that is always present and can be used to load image files as shown above.  Other filters can be added to the list by selecting them from the Filters menu.  Filters are chained and applied in the order that they appear in this list.  Selecting any filter in the filter list displays that filter's configuration panel below the filter list.  Changes to filter parameters are visible instantly in the image window.</p>

<p>The Remove button at the bottom of the filter list removes the currently selected filter from the filter list.  The Image Files filter is a special filter that cannot be removed (with no image files loaded there is no image data to filter).  The Clear button resets the filter list to its initial state with no filters or image files loaded.</p>

<h3><a name="savingFilters"></a>Saving Filter Images</h3>
<p>A set of filtered images can be saved by selecting File&mdash;&gt;Save Filter Images from the menu.  This will save the output from the filter pipeline that is displayed in the image filter list, <em>not</em> the visualization displayed in the image panel.  Save Filter Images dialog includes controls for specifying the output directory and file naming convention to use.  There are also several output options:</p>

<dl>
<dt>Pixel Type</dt><dd>Specifies the data type of pixels in the output images. Use 16-bit for images with intensities in the normal camera output range (floating point values will be truncated).  Use floating point for computed images that have small fractional values.</dd>
<dt>Rescale Intensities</dt><dd>When this box is checked, the output image intensities will be rescaled to match the full range allowed by the output pixel type.</dd>
</dl>

<p><span class="warning">Note:</span> Saving filter pipeline output requires understanding a little about image file types.  ImageTracker can save image files in any format supported by ITK.  This includes TIFF, PNG, JPG, MHA, and VTK among many others.  Some file types (<em>e.g.</em> TIFF and PNG) only allow integer pixel types, and specifying a floating point pixel type will likely produce an error.  When saving floating point images, be sure to select a file extension that has floating point support (<em>e.g.</em> MHA and VTK).</p>

<h3><a name="threshold"></a>Threshold</h3>
<p><span class="figure">
<a href="img/Threshold.jpg"><img src="img/Threshold.jpg" alt="Threshold filter"/></a><p>The Threshold filter limits the range of intensities present in an image.</p></span>
The threshold filter sets any pixels from an input image that lie outside an intensity range to zero (black).  The threshold control panel has the following controls:</p>

<dl>
<dt>Upper and Lower Bound</dt><dd>Sliders that adjust the range of pixel intensities that pass through the threshold filter.</dd>
<dt>Range</dt><dd>Controls the range of pixel intensities displayed on the threshold bound sliders.  There are presets for 8-bit and 16-bit images, and an option for setting the slider range to match the intensities of the current input image.</dd>
</dl>

<h3><a name="gaussian"></a>Gaussian</h3>
<p><span class="figure">
<a href="img/GaussianFilter.jpg"><img src="img/GaussianFilter.jpg" alt="Gaussian filter"/></a><p>The Gaussian filter applies smoothing to an image.</p></span>
The Gaussian filter convolves an input image with a Gaussian kernel.  Convolution with a zero-order Gaussian smooths (blurs) the image.  The scale (standard deviation) of the Gaussian filter determines the degree of smoothing applied.  Convolution with a first-order Gaussian along one dimension computes the derivative of the image along that dimension at the scale of the Gaussian.  The Gaussian filter control panel has the following controls:</p>

<dl>
<dt>X- and Y-direction Scale</dt><dd>Sliders that select the Gaussian kernel scale along the x and y dimension of the input image.  The scale determines the standard deviation of the Gaussian kernel in pixel units.</dd>
<dt>Lock</dt><dd>When the Lock button is depressed, the X- and Y-direction Scale sliders will move together.</dd>
<dt>X- and Y-direction Order</dt><dd>Controls the order of the Gaussian filter applied along each dimension.</dd>
</dl>

<h3><a name="gradient"></a>Gradient Magnitude</h3>
<p><span class="figure"><a href="img/GradientMagnitude.jpg"><img src="img/GradientMagnitude.jpg" alt="Gradient magnitude filter"/></a><p>The Gradient Magnitude filter finds edges in an image.</p></span>
The Gradient Magnitude filter finds edges in an image.  The gradient (first derivative) of the input image is computed in each direction with a Gaussian kernel at a spatial scale (see Gaussian Filter), yielding Ix and Iy.  The gradient magnitude is then given by: G = sqrt(Ix^2 + Iy^2).  Edges become bright in a gradient magnitude image, so this filter is often used as an edge detector.  The Gradient Magnitude control panel has the following controls:</p>
<dl>
<dt>Scale</dt><dd>The spatial scale of the Gaussian kernels used in gradient computation.  Larger values find the edges of larger image features.</dd>
<dt>Normalize Across Scale</dt><dd>When this option is checked, the brightness of the filtered image will not fade at larger spatial scales.  When this option is disabled, use the Window/Contrast control to rescale the contrast if the image becomes dim.</dd>
</dl>

<h3><a name="logarithm"></a>Logarithm</h3>
<p>The Logarithm filter takes the logarithm (base 10) of an image.  Zero values in the input image are mapped to zero values in the output image.  This filter has no options.</p>

<h3><a name="flatfield"></a>Flatfield</h3>
<p><span class="figure"><a href="img/Flatfield.jpg"><img src="img/Flatfield.jpg" alt="Flatfield filter"/></a><p>Flatfielding corrects for imaging artifacts such as constant occlusion and uneven illuminaton.</p></span>
Constant image flatfielding and/or subtraction are techniques commonly used in microscopy to correct for imaging artifacts.  Flatfielding divides input images by a constant image to correct for uneven illuminaton or occluding objects in bright field imaging.  An appropriate flatfield image would be an image of a blank slide or "bright" calibration (even better, the mean of several such images) or the transmission map obtained from the Remove Occlusions process (discussed below).  Background subtraction subtracts a constant image to correct for sensor noise or background signal in fluorescent microscopy.  An appropriate background image would be a "dark" calibration image taken with the lamp off (even better, the mean of several such images).  The Flatfield control panel enables either or both of these techniques to be applied simultaneously.  When both background (B) and flatfield (F) images are supplied, the output image (O) is given by: O = (I - B)/F.  That is, the background image is subtracted from the input image before flatfielding is applied.  The following controls compose the Flatfield control panel:</p>

<dl>
<dt>Flat Image</dt><dd>Specifies whether flatfielding should be applied.  When checked for the first time, this control prompts for the flatfield image.  To select a different flatfield image, use the Browse button.</dd>
<dt>Background Image</dt><dd>Specifies whether background subtraction should be applied.  When checked for the first time, this control propmts for the background image.  To select a different background image, use the Browse button.</dd>
</dl>

<h2><a name="processes"></a>Processes</h2>

<p>Processes in ImageTracker are generally more computationally intense than filters.  For example, optical flow computation finds a motion field that expains the intensity changes between images in a sequence.  The optical process results in a set of output vector images saved to disk.  Once the process launches, ImageTracker performs the flow computation on all image pairs in the sequence.  When the process is complete, ImageTracker may automatically load the result.</p>

<h3>Saving Data</h3>
<p><span class="figure">
<a href="img/OutputControlPanel.jpg"><img src="img/OutputControlPanel.jpg" alt="Output control panel"/></a><p>This control panel is common to all ImageTracker processes that output images.</p></span>
Whenever ImageTracker needs to save image data, a dialog box will prompt for output.  The output options are always the same.</p>
<dl>
<dt>Directory</dt><dd>The directory in which to save all output files</dd>
<dt>Prefix</dt><dd>The prefix to apply to saved images</dd>
<dt>Number format</dt><dd>A C-style number format, e.g. %04d, which means a zero-padded 4 digit integer</dd>
<dt>Extension</dt><dd>The file type extension to apply; ImageTracker will often choose this for you</dd>
<dt>File index range</dt><dd>The beginning and ending index for the file sequence; ImageTracker will often choose this for you</dd>
</dl>

<p><span class="warning">Note</span>:  ImageTracker saves images in 16 bit grayscale format. 16 bit images may appear completely dark in image viewers that only handle 8 bit images. ImageTracker, of course, is a 16 bit image viewer, and can be used to view the images it outputs.</p>

<h3><a name="occlusions"></a>Remove Occlusions</h3>

<p>
<span class="figure"><a href="img/RemoveOcclusions.jpg"><img src="img/RemoveOcclusions.jpg" alt="Removing occlusions"/></a><p>Removing fixed partial occlusions from a video of beating cilia.</p></span>
<span class="figure"><a href="img/CiliaOcclusions.jpg"><img src="img/CiliaOcclusions.jpg" alt="Before and after removing occlusions"/></a><p>Before (left) and after (right) partial occlusion removal.</p></span>
A lot of factors can contribute to microscopy images that are not optically optimal.  Objects that are spurious to the experiment end up in the optical path&mdash;this can be dust on the image sensor or coverslip, or it can be part of the specimen that is close enough to the focal plane (slab) to appear in the final image.  Occlusion removal may be able to remove <em>fixed</em> elements from <em>bright-field</em> micrsocopy videos in which the features of interest are moving. This method depends on the specimen moving and on the fixed occlusions transmitting a portion of the microscope's illumination.  The result of this process is a set of corrected images and the <em>transmission map</em> that holds the computed constant transmission factor at every location on the image plane. ImageTracker can open this type of image (it has floating point pixels), which can be useful to see the structure of occluding regions. In the transmission map, bright values indicate areas of the image plane that constantly transmitted a larger percentage of light than darker areas.  The transmission map can be used as a flatfield image when examining a longer image sequence captured with the same imaging system.</p>

<p>Select Process&mdash;&gt;Remove Occlusions to show the Remove Partial Occlusions dialog. The following parameters specify how occlusion removal will be attempted:</p>

<dl>
<dt>Metric</dt><dd>Specifies the computation that will be used to estimate the constant amount of light absorbed at each image location. The Mean metric is faster but the Median metric perfoms better if there are slow moving objects in the specimen.</dd>
<dt>Max Transmission</dt><dd>This setting adjusts the overall brightness of the final images. Select 100 to only increase the brightness of the image everywhere. Select 50 to maintain the average intensity between the input and output images. Note that some intensity values of the output images may become clipped to the maximum allowable output level. If this happens (the resulting images will looked washed out or saturated), decrease the value of this slider.</dd>
<dt>Fourier Padding</dt><dd>This value is seldom changed.  The padding slider corresponds to a windowing applied to images when using the Median transmission metric.  The default value of 0.5 will use a window of half the image size on each boundary when computing Fourier transforms.</dd>
<dt>Output</dt><dd>The common output options are available.</dd>
<dt>Transmission Map</dt><dd>This is an image file in which to store the transmission map.  Use an image type that supports floating point, such as MHA or VTK.</dd>
<dt>Open output when finished</dt><dd>If this box is checked, automatically load the output images when finished.</dd>
</dl>

<h3><a name="stabilize"></a>Stabilize</h3>

<p><span class="figure">
<a href="img/MultiResRegistration.jpg"><img src="img/MultiResRegistration.jpg" alt="Multiresolution registration"/></a><p>Multiple resolution registration in action.</p></span>
Stabilization (registration) aligns image sequences with respect to certain types of motion.  To align a pair of images, the transform that best aligns intensities in two images is found.  The effect on an image sequence transfroms the images such that strong image features do not move from frame to frame.  Note that thresholding can often improve the registration by segmenting the objects of interest and surpressing the background.</p>

<p><span class="figure">
<a href="img/ImagePyramid.jpg"><img src="img/ImagePyramid.jpg" alt="Image pyramid"/></a><p>A six level image pyramid.</p></span>
Multiple resolution registration aligns images iteratively using a series of coarse to fine image resolution scales. This method provides several advantage over single-scale resolution: it is more robust to large initial displacements, it enables targeting the scale of features to consider for registration, and it typically performs faster.  The method relies on the user specifying an <em>image pyramid</em>, that defines a series of image resolutions.  Registration is performed at each pyramid level starting at the most coarse; the result of each level's registration is propagated to the next level of the pyramid.  Each lower resolution level of the image pyramid is generated by smoothing and rescaling the preceding image to half its width and height.</p> 

<p>Launch the Multi-Resolution Registration dialog by selecting Process&mdash;&gt;Stabilize from the ImageTracker menu. The alignment dialog consists of the following options:</p>

<dl>
<dt>Smoothing</dt><dd>Defines the resolution bounds of the multiscale pyramid.  Adjusting either of these sliders updates the image in the image panel to show the effect of the smoothing.</dd>
<dt>Maximum Smoothing</dt><dd>Adjust the Maximum Smoothing to smooth all but the coarsest image features that should be aligned.</dd>
<dt>Minimum Smoothing</dt><dd>Adjust the Minimum Smoothing to smooth noise and any small scale features that should not be considered for alignment.</dd>
<dt>Optimization</dt><dd>The parameters in this section are seldom changed.  These parameters change the inner-workings of the multiresolution registration algorithm.</dd>
<dt>Iterations</dt><dd>The maximum number of alignments to try at each resolution scale.</dd>
<dt>Initial Maximum Step Length</dt><dd>The largest translation (in pixel units) to try at each alignment iteration at the coarsest scale.</dd>
<dt>Initial Minimum Step Length</dt><dd>The smallest translation (in pixel units) to try at each alignment iteration at the coarsest scale; for motion below this, the algorithm continues to the next resolution.</dd>
<dt>Inter-level Step Scale</dt><dd>The factor by which to divide the Step Lengths at each finer scale.</dd>
<dt>Output</dt><dd>The common output options are available.</dd>
<dt>Transform File</dt><dd>A text file in which to store the image alignment transforms.  This file is useful to apply the same alignment to a different set of images (<em>e.g.</em> for multi-channel imaging.</dd>
<dt>Open output when finished</dt><dd>If this box is checked, automatically load the output images when finished.</dd>
</dl>

<p><span class="warning">Note</span>:  ImageTracker adds black pixels to transformed images where there is no original image data.  Because ImageTracker also rescales images to maximize contrast when displaying images, it may appear that the image intensity has shifted in transformed images.</p>

<h3><a name="transform"></a>Apply Transform</h3>

<p><span class="figure">
<a href="img/ApplyTransform.jpg"><img src="img/ApplyTransform.jpg" alt="Applying transform"/></a><p>Applying a set of transforms from a previous alignment to a new data source.</p></span>
Sometimes more than one image sequence is captured during an experiment. In some situations it may be easier to compute registration transforms from one series of images and apply them to another. For example, with separate fluorescent labeling of a mitotic spindle and kinetechores, the spindle image channel contains enough information to obtain a good alignment while the kinetechore channel does not.  Select Process&mdash;&gt;Apply Transform to launch the Apply Transform dialog.  This process has the following options:</p>

<dl>
<dt>Transform File</dt><dd>Specify the text file that contains the transfrom information from the previous image registration.  This should be output from a Stabilize process.</dd>
<dt>Output</dt><dd>The common output options are available.</dd>
<dt>Open output when finished</dt><dd>If this box is checked, automatically load the output images when finished.</dd>
</dl>

<h3><a name="clgFlow"></a>CLG Optical Flow</h3>

<p>ImageTracker provides methods to determine the image motion from an image sequence.  <em>Optical flow</em> is an estimation of real world motion projected onto the image plane.  In the case of 2D motion where the image plane is parallel to the motion plane, optical flow is a good estimate of real world motion.  This scenario is common in microscopy.  Flow computation results in a vector image in which each pixel vector represents the computed velocity in the image's x and y directions.  Vector images can be loaded and viewed from the Vectors data tab.</p>

<p><span class="figure">
<a href="img/CLGOpticFlow.jpg"><img src="img/CLGOpticFlow.jpg" alt="CLG optical flow"/></a><p>Computing the optical flow of a microscopy video.</p></span>
The Combined Local Global (CLG) method of optical flow computation is described in:  <em>Bruhn, Andres, Joachim Weickert, and Christoph Schnorr. Lucas/Kanade meets Horn/Schunck: Combining local and global optic flow methods. International Journal of Computer Vision, 61(3), 211-231, 2005.</em>  The implementation provided in ImageTracker is the multiresolution, simple temporal difference variant. The algorithm iteratively estimates optical flow by minimizing an engergy functional that includes a local intensity constancy term (the Lucas &amp; Kanade part) and a global smoothness term (the Horn &amp; Schunck part).</p>

<p>To compute optical flow, select Process&mdash;&gt;CLG Optical Flow from the menu.  When the CLG Optical Flow dialog is active, the image displayed in the image panel will be filtered with a <em>Harris feature detector</em>.  This image is useful for determining the Derivative and Integration scale parameters.  The goal is to adjust these scale parameters such that the features of interest appear as distinct blurry blobs.  The CLG process has the following options:</p>

<dl>
<dt>Derivative Scale</dt><dd>The spatial scale used to compute image derivatives; adjust this to the noise level present in the images.</dd>
<dt>Integration Scale</dt><dd>The spatial scale used when integrating local regions of the image.  Adjust this to the size of the predominant features that are being tracked.</dd>
<dt>Number of Levels</dt><dd>The number of resolution levels to use in the computation.  More levels are required if there are larger motions between frames.</dd>
<dt>Iterations</dt><dd>Specifies the number of iterations to complete when minimizing the error functional at each resolution level; more iterations will presumably provide a lower error residual but will take longer.</dd>
<dt>Regularization</dt><dd>Adjusts the constant scaling of the smoothness term in the energy functional; a larger number will result in smoother flow fields, a smaller number will allow more turbulent flow fields.  For 16 bit images, this number needs to be rather large, like 10e4.  For 8 bit images, 100-200 is a reasonable range.</dd>
<dt>Output</dt><dd>The common output options are available.</dd>
<dt>Open output when finished</dt><dd>If this box is checked, automatically load the output images when finished.  Remember that vector images and visualizations are controlled from the Vectors data tab.</dd>
</dl>

<p>Click the Run button to start the optical flow computation.  ImageTracker's implementation of the algorithm is notoriously slow to run; the progress bar will provide an estimate of how long the process will take after computing the flow for the first image pair.  When analyzing long image sequences, it is advisable to try the flow computation on a shorter image sequence to find an appropriate set of parameters and then analyze the full image sequence with the same settings.</p>

<h3><a name="hornFlow"></a>Hornn &amp; Schunck Optical Flow</h3>

<p>This process is seldom used because the CLG Optical Flow implementation is superior in several ways.  The Horn and Schunck optical flow computation is a classic motion estimation algorithm that uses only the global term from the CLG computation.  This process remains for comparison purposes only.  The following parameters control this process:</p>

<dl>
<dt>Derivative Scale</dt><dd>The spatial scale used to compute image derivatives; adjust this to the noise level present in the images.</dd>
<dt>Iterations</dt><dd>Specifies the number of iterations to complete when minimizing the error functional for each image pair; more iterations will presumably provide a lower error residual but will take longer.</dd>
<dt>Regularization</dt><dd>Adjusts the constant scaling of the smoothness term in the energy functional; a larger number will result in smoother flow fields, a smaller number will allow more turbulent flow fields.  For 16 bit images, this number needs to be rather large, like 10e4.  For 8 bit images, 100-200 is a reasonable range.</dd>
<dt>Output</dt><dd>The common output options are available.</dd>
<dt>Open output when finished</dt><dd>If this box is checked, automatically load the output images when finished.  Remember that vector images and visualizations are controlled from the Vectors data tab.</dd>
</dl>

<h3><a name="integrate"></a>Integrate Flow</h3>

<p><span class="figure">
<a href="img/IntegrateFlowDialog.jpg"><img src="img/IntegrateFlowDialog.jpg" alt="Integrate flow dialog"/></a><p>The flow integration dialog.</p></span>
The optical flow methods described above compute displacement from one frame to the next&mdash;this is the estimated image velocity in the time between frames.  Integrating a series of flow fields yeilds net image displacement from the first frame of a sequence.  Access flow integration through Process&mdash;&gt;Integrate Flow.  The following parameters control this process:</p>

<dl>
<dt>Step size</dt><dd>Specifies the step size (in frames) of the Runge-Kutta 4th order integration. The integration process saves results at the nearest whole step size, to match the spacing of input flow data. So, with a step size of 0.1 frames, displacement images will be saved every 10 steps.</dd>
<dt>Output</dt><dd>The common output options are available.</dd>
<dt>Open output when finished</dt><dd>If this box is checked, automatically load the output images when finished.  Remember that vector images and visualizations are controlled from the Vectors data tab.</dd>
</dl>

<h2><a name="versionhistory"></a>Version History</h2>
<p>The sections below outline the changes made to ImageTracker at each revision.</p>

<h3><a name="v3.00"></a>Version 3.00</h3>
<p>Features</p>
<ul>
<li>Redesign of data management makes it easier to understand which images and vectors are opened.</li>
<li>Ability to apply filters to loaded images and construct a filter pipeline.</li>
<li>Filters: Threshold, Flatfield, Gaussian, Gradient Magnitude, Logarithm.</li>
<li>Ability to save filtered images.</li>
<li>Multiresolution implementation of CLG Optical Flow.</li>
<li>Scalar and vector images reliably load after computation process are completed.</li>
<li>Choice between vector glyph and heigh map visualizations.</li>
<li>Log messages sent to a log file.  Logger panel and controls moved to a separate dialog.</li>
<li>View contrast control moved to a separate dialog.</li>
<li>Fixed inconsistent saving of output images to non-default directories.</li>
<li>Pixel type no longer needs to be selected when loading images.</li>
<li>Menu option enables turning on and off image sequence looping.</li>
<li>Manual launches from the Help menu.</li>
</ul>
<p>Known bugs</p>
<ul>
<li>ImageTracker occasionally crashes when a process finishes on Linux.</li>
<li>Preview Harris feature detector on CLG dialog should always auto-adjust contrast.</li>
<li>Vector visualization control not always visible initially (if loaded after a process finishes).</li>
<li>Not all file selection dialogs have appropriate file filters configured.</li>
<li>Image panel does not clear visualization when all data has been removed/cleared until a render event gets triggered.</li>
<li>Image index slider is not always synced with currenlty displayed image, especially during and after running processes and loading new data.</li>
</ul>

<h3><a name="v2.08"></a>Version 2.08</h3>
<p>This was a recompilation of version 2.07 using an installer that worked on more Windows machines.</p>

<h3><a name="v2.07"></a>Version 2.07</h3>
<p>Features</p>
<ul>
<li>Data source selection based on matching single file naming convention</li>
<li>Common control panel for specifying saved image file names</li>
<li>Documentation includes instructions for compiling on Linux</li>
</ul>
<p>Known bugs</p>
<ul>
<li>The installer does not seem to work on some Windows machines (fixed: v2.08) </li>
<li>Some output files (like transforms and transmission maps) do not save to the appropriate output directories. (fixed: 3.00) </li>
</ul>

<h3><a name="v2.06"></a>Version 2.06</h3>
<p>Features</p>
<ul>
<li>Vector image visualization</li>
<li>Scalar image contrast adjustment</li>
<li>More control over frame selection&mdash;single frame skip, and go to frame</li>
<li>Visualization image saving</li>
<li>Flow integration</li>
</ul>
<p>Known bugs</p>
<ul>
<li>ImageTracker sometimes hesitates a long time after selecting many image files for a data source.</li>
<li>wxWidgets truncates a data source file list if selecting more than ~1000 images. Loading large data sources may require selecting image files in chunks. (work around: v2.07)</li>
<li>If the image window size changes after saving one set of visualization images ImageTracker may subsequently saves corrupted visualizations.</li>
<li>Image spacing information is not preserved on all operations (e.g. Occlusion Removal).</li>
<li>The default directory from which to load image data seems to get stuck&mdash;it should always use the most recently used directory. (Seems Windows-specific.) (Partial solution: v2.07)</li>
<li>There is no check that a processing task can be performed on a selected data source; this can lead to a crash for mismatched data sources and processes. (resolved: v3.00)</li>
</ul>

<h3><a name="v2.05"></a>Version 2.05</h3>
<p>Features</p>
<ul>
<li>Significant usability improvements and bug fixes</li>
<li>Progress bars for all image processing tasks</li>
<li>Thread-safe logging keeps the logger window updated during heavy processing</li>
<li>Play, stop, rewind, and skip-to-end buttons control image display</li>
<li>Horn &amp; Schunck optical flow computation</li>
<li>Image information logging on demand</li>
<li>Slicker looking documenation</li>
</ul>
<p>Known bugs</p>
<ul>
<li>Some GUI elements may be unresponsive after an image processing task completes; the video control buttons (play, rewind, etc), however, work fine and pressing any of them seems to fix the unresponsiveness.  (fixed: v3.00)</li>
<li>If the system font size is set to be large, some dialog elements may be cut off or shortened; usually manually resizing dialog boxes resolves this issue, though some text fields are still set to be quite small.</li>
<li>The upper threshold slider is set improperly on the multiple-resolution registration dialog box; the application code really, really, tries to set this&mdash;the same style code works for setting up the range on 16-bit images. (fixed: v2.06)</li>
</ul>

<h3><a name="v2.04"></a>Version 2.04</h3>
<p>Features</p>
<ul>
<li>Minor bug fixes, including file naming and a correction of the sign of computed flow fields</li>
</ul>

<h3><a name="v2.03"></a>Version 2.03</h3>
<p>Features</p>
<ul>
<li>Remove fixed partial occlusions from brigt-field microscopy videos</li>
<li>Apply transforms from one image registration to another set of images</li>
<li>Better image file managment, including data sources and the ability to specify the pixel type of image files</li>
<li>A data source frame slider that cycles through image files in data sources</li>
<li>Automatic openning of image processing results</li>
<li>Better image preview ability&mdash;while a dialog with preview component is visible, that preview appears in the ImageTracker main window; the preview is removed with the dialog is closed</li>
<li>Adjustable size logging and data source panels</li>
<li>Feature-based tracking has been removed</li>
</ul>
<p>Known bugs</p>
<ul>
<li>When selecting a group of files to constitute a data source, the last file is inserted at the top of the list. This only occurs on Windows XP, so this may be a wxWidgets compatibility issue. (fixed: v2.05)</li>
<li>Sometimes dialogs stay open and become unresponsive when an operation finishes. If this happens, select the ImageTracker menu item that launched the dialog initially. The dialog can then be closed. This problem only occurs on Windows XP, so this may be a wxWidgets compatibility issue. (fixed: v2.05)</li>
<li>The logging window does not always update while processes are running. It is advisable to try a processing task with a small set of images first, to gauge how long it might take. (fixed: v2.05)</li>
<li>If two data sources with different image counts are loaded in ImageTracker, the application may crash when the frame slider overruns the index of the shorter data source. (fixed: v2.06)</li>
<li>If the ImageTracker main window split panes (which separate the logging and data source panels from the image panel) are collapsed, there is no way to recover the hidden panels.</li>
</ul>

<h3><a name="v2.02"></a>Version 2.02</h3>
<p>Features</p>
<ul>
<li>A multiple resolution registration method that provides  faster, more robust, and more flexible image alignment</li>
<li>Enhanced support for saving different types of images, notably TIFFs</li>
<li>Adjustable logging message level in help menu</li>
</ul>

<h3><a name="v2.01"></a>Version 2.01</h3>
<p>Features</p>
<ul>
<li>A  new main application window combines an image file list, image window, and logging window all in one</li>
<li> Images are displayed with VTK, allowing zooming, and panning transformations</li>
<li>TIFF images still supported (this sounds like a non-feature, but it was a significant amout of work to keep TIFFs supported with the new application structure)</li>
<li>Stand-alone executable (no DLLs required)</li>
</ul>
<p>Known bugs</p>
<ul>
<li>Some TIFF images may not save (e.g. for global registration). (resolved: v3.00)</li>
<li>ParaView will not read some flow fields generated by ImageTracker; this seems very random, as changing a parameter slightly may generate a readable flow field.</li>
</ul>

<h3><a name="v2.00"></a>Version 2.00</h3>
<p>Features</p>
<ul>
<li>Feature-based tracking</li>
<li>CLG optical flow computation </li>
<li>8 and 16 bit images supported</li>
<li>TIFF images supported</li>
<li> Better image data management </li>
</ul>
<p>Known bugs</p>
<ul>
<li>Feature tracking may fail if fewer features are found in an image than are specified to track.</li>
<li>Reloading the Feature Tracker dialog does not reflect changes to the current images list (fixed: v2.01).</li>
</ul>

<h3><a name="v1.00"></a>Version 1.00</h3>
<p>Features</p>
<ul>
<li>Loading and viewing images sequences</li>
<li>Global registration of image sequences</li>
<li>Threshold prefilter for registration</li>
<li>Smoothing prefilter for registration</li>
<li>Saving registration transform data and transformed original image files.</li>
<li>Multi-level logging to window</li>
</ul>
<p>Known bugs</p>
<ul>
<li>Images other than 8-bin PNG may not load properly. (fixed: v2.00)</li>
<li>Image canvas disappears on occasion; when viewing lots of images or resizing image canvas. (fixed: v2.00)</li>
<li>Large images may cause exceptions on resizing canvas. (fixed: v2.00)</li>
<li>Memory leak: memory use grows when running registration multiple times. (fixed: v2.00)</li>
</ul>

</div> <!-- end content -->
</div> <!-- end container -->

<div id="footer">
<p>ImageTracker<br/>
by Brian Eastwood</p>
<p class="validation">
<a href="http://validator.w3.org/check/referer">xhtml</a> | 
<a href="http://jigsaw.w3.org/css-validator/check/referer">css</a>
</p>
</div> <!-- end footer -->

</body>
</html>
